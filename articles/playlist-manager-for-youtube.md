---
title: "YouTube (Music) のプレイリスト管理を楽にするウェブアプリを Next.js で作った"
emoji: "🗂"
type: "idea"
topics: ["nextjs", "react", "typescript", "i18n", "youtube"]
published: false
---
# はじめに
こんにちは。[鈴木](https://github.com/suzuki3jp)です。
個人開発で YouTube、YouTube Music のプレイリストを簡単にするウェブアプリケーション [**Playlist Manager For YouTube**](https://pmfy.suzuki3.jp) を開発しました。
リポジトリはこちらです。
https://github.com/suzuki3jp/YouTubePlaylistManager

# 何ができる？
YouTube, YouTube Music のプレイリストを管理できます。
- プレイリストをコピー
- プレイリストのアイテムをシャッフル
- プレイリスト同士を結合
- プレイリストを削除
- プレイリストのアイテムを検索
TODO: スクショを追加 figure 1みたいな感じで指定してもいいかも

# 使用技術
|  |  |
| ---- | ---- |
| Vercel | デプロイ先 Next.jsと相性がいい |
| Next.js | フレームワーク |
| TypeScript | 型最高！ |
| Material UI | コンポーネントライブラリ 今のデザインに満足していないので他のライブラリに乗り換えるかも |
| NextAuth | Google OAuth を簡単に |
| YouTube Data API v3 | NextAuth で取得したアクセストークンを使用して、APIにリクエスト |

# 開発の背景
## プレイリスト同士をマージしたい
普段から YouTube Music を使っていて、K-POP, 洋楽などジャンル別のプレイリストを作成しています。
それらのジャンルの曲を含んだ "すべて" のようなプレイリストを作成したかったのですが、当時すでに K-POP プレイリストは150曲ほど、洋楽プレイリストは100曲ほど入っていたので手作業で追加するには大変な量でした。
## プレイリストのアイテムをシャッフルしたい
また、iOSの YouTube Music Widget をホーム画面に追加してそこから再生しようとすると毎回プレイリストの再生が最初からになり、そしてシャッフルをオンにしていても毎回オフにリセットされるというバグ？があります。
そのためプレイリストのアイテムを定期的にシャッフルして再生される曲の偏りを防ぐためにもシャッフルを行いたかったです。

# 今回の開発を経て得たこと
##  Next.js Server Actions はなるべく小さい粒度で作成する
当初プレイリストの コピー・シャッフル・マージ・削除 の操作を行う Server Action をそれぞれ作成していました。
しかしコピーなどは処理完了までに長い時間が予想されるので、進捗を表示するために state を変更するようなイベントハンドラを Server Action に渡そうと思ったところ、Server Action はクライアントサイドで定義された関数を渡せないようで、進捗の表示に行き詰まっていました。

そこで Server Actions を プレイリストを作成する・プレイリストにアイテムを追加する・プレイリストアイテムのポジションを変更する のようになるべく小さな粒度で作成します。
そしてそれらを コピー・シャッフル・マージ の固有のロジックを含んだ純粋な関数から呼び、その関数にクライアントサイドで定義したイベントハンドラを渡すことで進捗の表示を実装しました。