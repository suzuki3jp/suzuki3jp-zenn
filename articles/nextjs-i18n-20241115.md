---
title: "Next.js ã§ i18n å¯¾å¿œã™ã‚‹ã¾ã§"
emoji: "ğŸŒ"
type: "tech"
topics: ["nextjs", "approuter", "react", "typescript", "i18n"]
published: true
published_at: 2024-11-16 10:03
---

# ã¯ã˜ã‚ã«
æ•°å¹´å‰ã‹ã‚‰ç‹¬å­¦ã§ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’å­¦ã³ã€æœ€è¿‘ã¯å€‹äººé–‹ç™ºã‚’ã—ã¦ã„ã‚‹[éˆ´æœ¨](https://github.com/suzuki3jp)ã§ã™ã€‚

ä»Šå›ã¯ä»Šé–‹ç™ºã—ã¦ã„ã‚‹ [PlaylistManager](https://github.com/suzuki3jp/PlaylistManager) ã¨ã„ã†ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã€i18nå¯¾å¿œã™ã‚‹ãŸã‚ã«å¿…è¦ã ã£ãŸã“ã¨ãªã©ã‚’ã¾ã¨ã‚ã¾ã™ã€‚
å®Ÿéš›ã®å®Ÿè£…ã«é–¢ã™ã‚‹ã‚³ãƒŸãƒƒãƒˆã¯ä»¥ä¸‹ã®äºŒã¤ã§ã™:  
- [ãƒ¡ã‚¤ãƒ³ã®å¤‰æ›´](https://github.com/suzuki3jp/PlaylistManager/commit/384d57644c6782088b8e74a3e61e1da24cc8bd6c)
- [è¨€èªå¤‰æ›´ã®`SelectMenu`ã®å®Ÿè£…](https://github.com/suzuki3jp/PlaylistManager/commit/140fe3a682f9d82355f0493fe57a50c0467a3fce)
# å‰æ
1. ã™ã§ã«ã‚ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® i18n å¯¾å¿œãªã®ã§ã€ç ´å£Šçš„ã§å¤§ããªå¤‰æ›´ã¯ã—ãŸããªã‹ã£ãŸã€‚
2. è¨€èªã‚’å¤‰æ›´ã—ãŸã¨ãã«ã€ã»ã‹ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã¯ç¶­æŒã—ãŸã„ã®ã§ã€ãƒšãƒ¼ã‚¸å…¨ä½“ã®ãƒªãƒ­ãƒ¼ãƒ‰ã‚’å¿…è¦ã¨ã—ãªã„ã€‚

# å®Ÿè£…æ–¹é‡
- è¨€èªã¯ URLã«å«ã¾ã‚Œã¦ã„ã‚‹ã‚¯ã‚¨ãƒªï¼ˆ`?lang=ja`ï¼‰ã§æ±ºå®šã™ã‚‹
  - ãƒ‘ã‚¹ã«è¨€èªã‚’å«ã‚ã‚‹æ–¹æ³•ï¼ˆ`/[lang]/path/to/resource`ï¼‰ã‚‚ã‚ã‚‹ã‚ˆã†ã ãŒã€å‰æ1ã‚’è€ƒæ…®ã—ã¦ã‚¯ã‚¨ãƒªã«æ±ºå®šã€‚
- è¨€èªå¤‰æ›´ã¯ SelectMenu ã§å®Ÿè£…

# å®Ÿè£…
## å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
ä»Šå›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ [`pnpm`](https://pnpm.io/) ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã®ã§ `pnpm` ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
```bash
pnpm add next-i18next react-i18next i18next i18next-resources-to-backend
```

## `next-i18next` ã®è¨­å®š
ä»Šå›ã¯ `src/locales/[lang]/` é…ä¸‹ã«ãã‚Œãã‚Œã®è¨€èªã®JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®ã™ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚
```json:src/locales/en/common.json
{
    "title": "Sample title"
}
```
```json:src/locales/ja/common.json
{
    "title": "ã‚µãƒ³ãƒ—ãƒ«ã‚¿ã‚¤ãƒˆãƒ«"
}
```
```ts:src/locales/settings.ts
// ã“ã‚Œã¯ URL ã«å«ã¾ã‚Œã‚‹ã©ã®ã‚¯ã‚¨ãƒªã‚’è¨€èªè¨­å®šç”¨ã«ã™ã‚‹ã‹ã®é …ç›®ã§ã™ï¼ˆä»Šå›ã¯ `?lang=en`ï¼‰
export const QUERY_NAME = "lang";

// ã“ã“ã§æŒ‡å®šã™ã‚‹æ–‡å­—åˆ—ã¯ `src/locales/[lang]/` ã® lang ã«ä¸€è‡´ã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
export const DEFAULT_LANGUAGE = "ja";
export const AVAILABLE_LANGUAGES = [DEFAULT_LANGUAGE, "en"];

export const getOptions = (lang: string = DEFAULT_LANGUAGE) => {
	return {
		lng: lang,
		fallbackLng: DEFAULT_LANGUAGE,
		supportedLngs: AVAILABLE_LANGUAGES,
	};
};
```

## URLã«å«ã¾ã‚Œã‚‹ã‚¯ã‚¨ãƒªã‹ã‚‰è¨€èªã‚’æ±ºå®šã™ã‚‹ãƒ•ãƒƒã‚¯ã‚’ä½œæˆã™ã‚‹
ä»Šå›ã¯ `useT` ã¨ã„ã†ãƒ•ãƒƒã‚¯ã‚’ä½œæˆã—ã€ãã®ä¸­ã§è¨€èªã‚’æ±ºå®šã—ã€ãã®è¨€èªã® `t` é–¢æ•°ã‚’å–å¾—ã—ã¾ã™ã€‚
```ts:src/hooks/useT.ts
"use client";
import { DEFAULT_LANGUAGE, QUERY_NAME, getOptions } from "@/locales/settings";
import i18next from "i18next";
import resourceToBackend from "i18next-resources-to-backend";
import { useSearchParams } from "next/navigation";
import { useEffect } from "react";
import { initReactI18next, useTranslation } from "react-i18next";

i18next
	.use(initReactI18next)
	.use(
		resourceToBackend(
			(lang: string, namespace: string) =>
				import(`@/locales/${lang}/${namespace}.json`),
		),
	)
	.init(getOptions());

export const useT = () => {
	const query = useSearchParams();
    // lang ã‚¯ã‚¨ãƒªãŒå«ã¾ã‚Œã¦ã„ãªã„å ´åˆ `DEFAULT_LANGUAGE` ãŒä½¿ç”¨ã•ã‚Œã¾ã™
	let lang = query.get(QUERY_NAME) || DEFAULT_LANGUAGE;
	lang = AVAILABLE_LANGUAGES.includes(lang) ? lang : DEFAULT_LANGUAGE;

    // ã“ã® `common` ã¯ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹åã§ã™ã€‚ä»Šå›ã¯ `common.json` ãªã®ã§ `common` ã‚’è¨­å®š
    // jsonãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¢—ã‚„ã—ã€ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã‚’åˆ©ç”¨ã—ãŸã„å ´åˆã€`useT` ã«å¼•æ•°ã‚’è¨­å®šã—ã¾ã—ã‚‡ã†
	const { t, i18n } = useTranslation("common");

	useEffect(() => {
		i18n.changeLanguage(lang);
	}, [lang, i18n]);

    return { t, i18n, lang };
};
```

## ç¿»è¨³ã‚’åˆ©ç”¨ã™ã‚‹
```tsx:src/app/page.tsx
import { useT } from "@/hooks/useT.ts"

export default function Home() {
    const { t } = useT();

    return <h1>{t("title")}</h1> // "ã‚µãƒ³ãƒ—ãƒ«ã‚¿ã‚¤ãƒˆãƒ«" ã‹ "Sample title" ãŒè¨€èªè¨­å®šã«å¿œã˜ã¦è¡¨ç¤ºã•ã‚Œã¾ã™
}
```

JSONãƒ•ã‚¡ã‚¤ãƒ«å†…ã§ã®ãƒã‚¹ãƒˆã«ã‚‚å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚
```json:src/locales/en/common.json
{
    "metadata": {
        "title": "Sample title",
        "description": "Sample description"
    }
}
```
```ts
{t("metadata.title")}
{t("metadata.description")}
```

å‹•çš„ãªå€¤ã‚’ç¿»è¨³ã«åˆ©ç”¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚
```json:src/locales/en/common.json
{
    "hi": "Hi! {{name}}!"
}
```
```ts
{t("hi", { name: "SUZUKI" })} // "Hi! SUZUKI!"
```

## è¨€èªã‚’å¤‰æ›´ã™ã‚‹
ã“ã“ã§ã¯è¨€èªã‚’å¤‰æ›´ã™ã‚‹é–¢æ•°ã®ã¿ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚
ã“ã‚Œã‚’ãƒœã‚¿ãƒ³ãªã‚Šã‚»ãƒ¬ã‚¯ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ãªã‚Šã® `onClick` ãªã©ã«ã‚ˆã—ãªã«æ¸¡ã—ã¦ãã ã•ã„ã€‚
å®Ÿéš›ã®ã‚»ãƒ¬ã‚¯ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã®å®Ÿè£…ä¾‹ã¯ [ã“ã®ã‚³ãƒŸãƒƒãƒˆ](https://github.com/suzuki3jp/PlaylistManager/commit/140fe3a682f9d82355f0493fe57a50c0467a3fce#diff-32d6906cd67f2c1b2857da9d190d9a8e175d972f98249c599c8015aa148511ef) ã«ã‚ã‚Šã¾ã™ã€‚
```ts
"use client";
import type { AVAILABLE_LANGUAGES, QUERY_NAME } from "@/locales/settings.json";
import { useRouter } from "next/navigation";

const changeLang = (newLang: AVAILABLE_LANGUAGES) => {
    const router = useRouter();

    const newParams = new URLSearchParams();
    params.set(QUERY_NAME, newLang);
    router.push(`?${params.toString()}`) // ãƒªãƒ­ãƒ¼ãƒ‰ãªã—ã§å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹ï¼ˆãŸã¶ã‚“ï¼‰
}
```

# ã•ã„ã”ã«
ä»Šå›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã¾ã é–‹ç™ºä¸­ã§èª¬æ˜ãªã©é™çš„ãªãƒšãƒ¼ã‚¸ãŒå…¨ããªãã€ã™ã¹ã¦ãŒçŠ¶æ…‹ã«ã‚ˆã£ã¦å¤‰åŒ–ã™ã‚‹å‹•çš„ãªãƒšãƒ¼ã‚¸ã§ã—ãŸã€‚
ãã®ãŸã‚ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã¿ã®i18nå¯¾å¿œã ã£ãŸã®ã§ã€ä»Šå¾Œã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã‚‚i18nå¯¾å¿œã™ã‚‹å¿…è¦ãŒã‚ã£ãŸã‚‰ã€è¿½è¨˜ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚
ã‚ˆã‘ã‚Œã°ä»–ã®è¨˜äº‹ã€`PlaylistManager` ã®ã‚¹ã‚¿ãƒ¼ã‚‚ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ï¼
https://github.com/suzuki3jp/PlaylistManager
https://zenn.dev/suzuki3jp/articles/nextauth-approuter-google-20241025